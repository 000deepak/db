
## Aggregation
- process data records and return computed results group values from multiple documents together can perform a variety of operations on the grouped data to return a single result.
- In SQL count(*) and with group by is an equivalent of mongodb aggregation.

----------------------------
| Expression   | Description                                                                                     | Example                                                                                              |
|--------------|-------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| $sum         | Sums up the defined value from all documents in the collection.                                 | `db.myCollection1.aggregate([{$group : {_id : "$by_user", num_tutorial : {$sum : "$likes"}}}])`        |
| $avg         | Calculates the average of all given values from all documents in the collection.                | `db.myCollection1.aggregate([{$group : {_id : "$by_user", num_tutorial : {$avg : "$likes"}}}])`        |
| $min         | Gets the minimum of the corresponding values from all documents in the collection.              | `db.myCollection1.aggregate([{$group : {_id : "$by_user", num_tutorial : {$min : "$likes"}}}])`        |
| $max         | Gets the maximum of the corresponding values from all documents in the collection.              | `db.myCollection1.aggregate([{$group : {_id : "$by_user", num_tutorial : {$max : "$likes"}}}])`        |
| $push        | Inserts the value to an array in the resulting document.                                         | `db.myCollection1.aggregate([{$group : {_id : "$by_user", url : {$push: "$url"}}}])`                  |
| $addToSet    | Inserts the value to an array in the resulting document but does not create duplicates.         | `db.myCollection1.aggregate([{$group : {_id : "$by_user", url : {$addToSet : "$url"}}}])`             |
| $first       | Gets the first document from the source documents according to the grouping.                    | `db.myCollection1.aggregate([{$group : {_id : "$by_user", first_url : {$first : "$url"}}}])`          |
| $last        | Gets the last document from the source documents according to the grouping.                     | `db.myCollection1.aggregate([{$group : {_id : "$by_user", last_url : {$last : "$url"}}}])`            |



- display aggregate, 
```js
db.myCollection1.aggregate([
    {
    - $group : {                          - group by
            _id : "$by_user",               - group by 'by_user'       => per user
            num_of_books_1: {
            - $sum : 1                    - number of books ($sum), per user,   here, 1 means +ve sum
            }
        }
    }
])
```

## Pipeline
- In UNIX command, shell pipeline means the possibility to execute an operation on some input and use the output as the input for the next command and so on.
- MongoDB also supports same concept in aggregation framework. 
- There is a set of possible stages and each of those take a set of documents as an input and produces a resulting set of documents (or the final resulting JSON document at the end of the pipeline). 
- These can then in turn be used for the next stage and so on.

## Following are the possible stages in aggregation framework -
- $limit      
	- This limits the amount of documents to look at, by the given number starting from the current positions.
- $skip       
	- With this, it is possible to skip forward in the list of documents for a given amount of documents.
- $sort       
	- Sorts the documents.
- $project    
	- Used to select some specific fields from a collection.
- $group      
	- This does the actual aggregation as discussed above.
- $match      
	- This is a filtering operation and thus this can reduce the amount of documents that are given as input to the next stage.
- $unwind     
	- This is used to unwind document that are using arrays. When using an array, the data is kind of pre-joined and this operation will be undone with this to have individual documents again. Thus with this stage we will increase the amount of documents for the next stage.
---------------------------------


| Parameter           | Type           | Description                                                                                                                                                                                                                   |
|---------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| background          | Boolean        | Builds the index in the background so that building an index does not block other database activities. Specify true to build in the background. The default value is false.                                                    |
| unique              | Boolean        | Creates a unique index so that the collection will not accept insertion of documents where the index key or keys match an existing value in the index. Specify true to create a unique index. The default value is false. |
| name                | string         | The name of the index. If unspecified, MongoDB generates an index name by concatenating the names of the indexed fields and the sort order.                                                                                  |
| dropDups            | Boolean        | Creates a unique index on a field that may have duplicates. MongoDB indexes only the first occurrence of a key and removes all documents from the collection that contain subsequent occurrences of that key. Specify true to create unique index. The default value is false. |
| sparse              | Boolean        | If true, the index only references documents with the specified field. These indexes use less space but behave differently in some situations (particularly sorts). The default value is false.                             |
| expireAfterSeconds  | integer        | Specifies a value, in seconds, as a TTL to control how long MongoDB retains documents in this collection.                                                                                                                    |
| v                   | index version  | The index version number. The default index version depends on the version of MongoDB running when creating the index.                                                                                                       |
| weights             | document       | The weight is a number ranging from 1 to 99,999 and denotes the significance of the field relative to the other indexed fields in terms of the score.                                                                        |
| default_language    | string         | For a text index, the language that determines the list of stop words and the rules for the stemmer and tokenizer. The default value is english.                                                                              |
| language_override   | string         | For a text index, specify the name of the field in the document that contains the language to override the default language. The default value is language.                                                                   |